title: "大型分布式"
date: 2015-7-5
tags: "分布式"
categories: 
---	

第一题：
用tcpdump、tshark等工具来来分析arp请求报文和应答报文，对照截获的数据，做出ARP请求应答的逻辑分析，建议本机安装虚拟机来进行测试和实践。

第二题：
如果一个VLAN交换机的所有端口都是Trunk模式，则意味着什么？

第三题：
说明下NAT在Linux中实现的原理和大致做法。

第四题：
路由的原理和机制是什么？解释下Linux里 ip route命令的结果。

第五题：
说说你所理解高性能网络编程的几个重要因素和他们之间的相互关系

第六题：
实现PPT中的最后那个案例，用Netty+Zookeeper写一个分布式系统，其中需求和要点如下：
1. 每个节点是一个TCP Server，采用Netty NIO实现，Server有一个Name，全局唯一，比如Leader-1,Leader-2，节点的监听IP、端口、以及TCP参数等配置信息在ZK的Config路径下保存，当节点启动的时候，根据其Name，去查找自己的配置信息，并生成为本地config目录下的配置文件 Name.properities （如Leader-1.properties），然后节点从配置文件中加载参数并启动，当ZK无法连接的时候，也仍然能通过读取本地配置文件而启动。
2. 节点启动成功以后，注册自己到Node路径下，并监听Node路径中其他节点的上线和下线行为，当节点停止后，对应的ZK路径消失，其他节点获取这一通知。
3. 当节点监听到有其他节点上线，则决定是否连接此节点，连接规则为通过Name比较，Name小的主动连接Name大的节点，一旦节点连接成功，则开始发生请求数据包，请求数据包的格式为二进制格式，具体为2个字节的包长度，1个字节的包类型，然后是数据，数据内容为本地随机一些文件的内容即可，接收方则将文件按照发送方的Name目录分别存放接受的文件，若重复，则覆盖即可。并在内存中记录最近接受的10个文件信息（节点、文件名、文件大小、接受时间）
4. 实现一个简单的命令行工具，该工具对集群进行远程控制，原理是通过在ZK的路径 command下创建具体节点的路径，比如commandsde1 ，表示发送给node1，命令的具体内容则在Path的Data里存放，比如 list files，此命令输出如下内容：
Node    file                size     process     time
Node1  aaa.txt         6666      50%           5s ago
Node2  bbb.txt         6666      80%           5s ago

目前要求实现两个命令，一个是上述的显示某个节点收到的文件信息
一个是Kill节点的命令，Kill节点命令，要求与该节点的所有节点发送完当前正在发送的文件，不再发送新的文件，被Kill的节点也把自己要发送给其他节点的文件都发送完成后，才安全的自杀。

作业的要求，程序可以解压在任何目录执行，里面需要有Bat命令，至少有一个Bat命令，双击以后，将所有节点（假设5个节点）一起启动，节点名称分别为leader-1,leader-2一直到leader-5，程序目录结构为
HOME
    Conf 配置信息
Data 存放自己本地的模拟文件和接受的文件
Lib 所有依赖的LIB
Bin  启动脚本的存放地方

ZK采用3.4.6的版本，命令行工具里面有一个命令 是init方法，再空白的ZKServer上初始化写入所有节点的配置信息，以便程序能启动。

本作业的其他一些提示：
节点启动的时候，可以随机在data目录下生成100个随机文本文件，内容长度随机控制在10K到10M，内容最后都为You are Best! 这些是待发送文件。
数据报文可以分为 文件开始传输，文件传输，文件传输完成、节点Shutdown等几种类型，其中文件传输完成的报文为发送文件最后一段内容时候的一个特殊报文，告诉对方，文件发送完成，文件开始传输报文则告诉对方，文件名，文件大小等信息，这样，对方可以知道还有多少内容等等接受。每个节点只能给另外一个节点每次发送一个文件，发送完成后再发下一个，但可以同时给几个节点发送文件。
当某个节点收到Shutdown指令的时候，需要让他周边的所有节点知道他要Shutdown了，不会在准备发送新的文件（默认情况下，当一个文件发送完成，会继续发送下一个），这样此节点才可能有机会安全关闭